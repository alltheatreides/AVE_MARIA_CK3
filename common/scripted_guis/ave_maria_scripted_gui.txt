########################################################################################
#                                         											   #
# AVE MARIA Scripted GUIS															   #
# A Very Extensive Modification for Appropriate Realism and Improved Authenticity	   #
#                                         											   #
# Roman Administration Scripted GUIS                   								   #
#                               													   #
########################################################################################

## Written by Atreides

# TABLE OF CONTENT:

##### 1) FUNCTIONAL SCRIPTED GUI
##### Triggers and effects to open and close new created menus

##### 1) SCRIPTED GUI FOR VARIABLE LIST & OTHERS
##### Triggers and effects to create the various lists related to the institutions


#############################################
# FUNCTIONAL TYPE SCRIPTED GUI				#
#############################################

## Purged as of 17/02/21, better way to do it

#############################################
# OTHER INSTITUTION SCRIPTED GUI			#
#############################################
## CONDITIONAL SCRIPTED GUI TO DETERMINE WHAT INSTITUTIONS YOU CAN SEE

## Checks for the gui file if you are the roman emperor
am_councillor_is_roman_emperor = {
	scope = character

	is_shown = {
		primary_title = {
			this = title:e_byzantium
		}
	}
}

am_councillor_not_roman_emperor = {
	scope = character

	is_shown = {
		primary_title = {
			NOT = {
				this = title:e_byzantium
			}			
		}
	}
}

## Checks for the gui file to see if you can have no institutions
am_institutions_has_no_institutions = {
	scope = character

	is_shown = {
		exists = this
		NOR = {
			primary_title = {
				this = title:e_byzantium
			}
			any_liege_or_above = {
				primary_title = {
					this = title:e_byzantium
				}
			}
		}
	}
}

#############################################
# SENATE INSTITUTION SCRIPTED GUI			#
#############################################
## Trigger Check for the gui file to see if you can see the senate
am_institutions_roman_administration_can_see_senate = {
	scope = character

	is_shown = {
		exists = this
		OR = {
			primary_title = {
				this = title:e_byzantium
			}
			any_liege_or_above = {
				primary_title = {
					this = title:e_byzantium
				}
			}
		}
	}
}

## Create the senator variable list when you click on a gui button to display the senators visually
## Also creates the approval rating list of people depending on their opinion for the visual display
am_institutions_roman_administration_get_senator_list = {
	scope = character
	
	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			## Clear variable always before
			clear_variable_list = list_roman_administration_senators


			## Add all the duchy tier vassals to the senate
			every_vassal = {
				limit = {
					OR = {
						roman_administration_holds_high_office_title_trigger = yes
						has_trait = junior_emperor
						has_character_modifier = roman_administration_protospatharios
						has_character_modifier = roman_administration_patrikios
						has_character_modifier = roman_administration_anthypatos
						has_character_modifier = roman_administration_magistros
						has_character_modifier = roman_administration_vestarches
						has_character_modifier = roman_administration_proedros
						has_character_modifier = roman_administration_spatharios
					}
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_senators
						target = prev
					}
				}				
			}
			## Put the senators who like you into a specific list
			# every_vassal = {
			# 	limit = {
			# 		highest_held_title_tier = tier_duchy
			# 		opinion = {
			# 			target = root
			# 			value >= 0
			# 		}
			# 	}
			# 	root = {
			# 		add_to_variable_list = {
			# 			name = list_roman_administration_supportive_senators
			# 			target = prev
			# 		}
			# 	}
			# }

		}
		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_senators

				every_vassal = {
					limit = {
						OR = {
							roman_administration_holds_high_office_title_trigger = yes
							has_trait = junior_emperor
							has_character_modifier = roman_administration_protospatharios
							has_character_modifier = roman_administration_patrikios
							has_character_modifier = roman_administration_anthypatos
							has_character_modifier = roman_administration_magistros
							has_character_modifier = roman_administration_vestarches
							has_character_modifier = roman_administration_proedros
							has_character_modifier = roman_administration_spatharios
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_senators
							target = prev
						}
					}					
				}
				## Put the senators who like you into a specific list
				# every_vassal = {
				# 	limit = {
				# 		highest_held_title_tier = tier_duchy
				# 		opinion = {
				# 			target = root
				# 			value >= 0
				# 		}
				# 	}
				# 	root = {
				# 		add_to_variable_list = {
				# 			name = list_roman_administration_supportive_senators
				# 			target = prev
				# 		}
				# 	}
				# }
			}
		}
	}

}

## Trigger for the text of relevance of the senate
am_institutions_roman_administration_senate_political_relevance_irrelevant = {
	scope = character

	is_shown = {
		exists = this
		root = {
			title:e_byzantium = {
				has_variable = roman_administration_senate_political_relevance_irrelevant
			}
		}		
	}
}
am_institutions_roman_administration_senate_political_relevance_medium = {
	scope = character

	is_shown = {
		exists = this
		root = {
			title:e_byzantium = {
				has_variable = roman_administration_senate_political_relevance_medium
			}
		}
		
	}
}
am_institutions_roman_administration_senate_political_relevance_high = {
	scope = character

	is_shown = {
		exists = this
		root = {
			title:e_byzantium = {
				has_variable = roman_administration_senate_political_relevance_high
			}
		}		
	}
}


#############################################
# ROMAN ARMY INSTITUTION SCRIPTED GUI		#
#############################################

### ARMY RELATED SCRIPTED GUI
## Trigger Check for the gui file to see if you can see the roman army institution
am_institutions_roman_administration_can_see_roman_army = {
	scope = character

	is_shown = {
		exists = this
		OR = {
			primary_title = {
				this = title:e_byzantium
			}
			any_liege_or_above = {
				primary_title = {
					this = title:e_byzantium
				}
			}
		}
	}
}

## Create the military officials variable list when you click on a gui button to display the military visually
am_institutions_roman_administration_get_military_officials_list = {
	scope = character
	
	effect = {

		title:e_byzantium.holder = {
			## Clear variable always before
			clear_variable_list = list_roman_administration_military_officials
			clear_variable_list = list_roman_administration_military_officials_minus_high_officials
			clear_variable_list = list_roman_administration_imperial_tagma_officials

			## All the military officials
			every_vassal = {
				limit = {
					roman_administration_holds_military_title_trigger = yes
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_military_officials
						target = prev
					}
				}				
			}
			## provincial military officials
			every_vassal = {
				limit = {
					#roman_administration_holds_military_title_trigger = yes
					OR = {
						roman_administration_holds_doukaton_title_trigger = yes
						roman_administration_holds_strategos_title_trigger = yes
					}
					
					roman_administration_holds_tagma_title_trigger = no
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_military_officials_minus_high_officials
						target = prev
					}
				}				
			}
			## Only Imperial Tagma officials
			every_vassal = {
				limit = {
					roman_administration_holds_tagma_title_trigger = yes
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_imperial_tagma_officials
						target = prev
					}
				}				
			}

			ordered_in_list = {
				list = list_roman_administration_military_officials
				order_by = roman_administration_army_pecking_order_character
			}

		}

	}

}

## Create the High Military officials variable list when you click on a gui button to display the military visually
am_institutions_roman_administration_get_military_high_officials_list = {
	scope = character
	
	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			## Clear variable always before
			clear_variable_list = list_roman_administration_imperial_tagma_officials

			every_vassal = {
				limit = {
					roman_administration_holds_tagma_title_trigger = yes
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_imperial_tagma_officials
						target = prev
					}
				}				
			}
			every_vassal = {
				limit = {
					roman_administration_holds_tagma_title_trigger = yes
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_imperial_tagma_officials
						target = prev
					}
				}				
			}
		}
		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_imperial_tagma_officials

				every_vassal = {
					limit = {
						roman_administration_holds_tagma_title_trigger = yes
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_imperial_tagma_officials
							target = prev
						}
					}					
				}
				every_vassal = {
					limit = {
						roman_administration_holds_tagma_title_trigger = yes
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_imperial_tagma_officials
							target = prev
						}
					}				
				}
			}
		}
	}

}

am_institutions_roman_administration_get_doukaton_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					any_held_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_doukaton_list

				every_vassal = {
					limit = {
						has_government = roman_administration_doukaton_government
						NOT = {
							any_held_title = {
								this = title:d_antioch
							}
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_doukaton_list
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						any_held_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_doukaton_list

				every_vassal = {
					limit = {
						has_government = roman_administration_doukaton_government
						NOT = {
							any_held_title = {
								this = title:d_antioch
							}
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_doukaton_list
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_theme_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					any_held_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_theme_list

				every_vassal = {
					limit = {
						has_government = roman_administration_theme_government
						NOT = {
							any_held_title = {
								this = title:d_anatolia
							}
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_theme_list
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						any_held_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						any_held_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_theme_list

				every_vassal = {
					limit = {
						has_government = roman_administration_theme_government
						NOT = {
							any_held_title = {
								this = title:d_anatolia
							}
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_theme_list
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_domestikos_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_domestikos

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_megas_domestikos
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_domestikos
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_domestikos

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_megas_domestikos
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_domestikos
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_antioch_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_antioch

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_antioch
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_antioch
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_antioch

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_antioch
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_antioch
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_anatolia_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_anatolia

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_anatolia
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_anatolia
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_anatolia

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_anatolia
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_anatolia
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_excubitor_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_excubitor

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_excubitor
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_excubitor
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_excubitor

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_excubitor
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_excubitor
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_vigla_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_vigla

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_vigla
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_vigla
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_vigla

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_vigla
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_vigla
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_droungarios_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_droungarios

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_megas_droungarios
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_droungarios
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_droungarios

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_megas_droungarios
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_droungarios
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_hikanatoi_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_hikanatoi

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_hikanatoi
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_hikanatoi
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_hikanatoi

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_hikanatoi
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_hikanatoi
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_noumeroi_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_noumeroi

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_noumeroi
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_noumeroi
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_noumeroi

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_noumeroi
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_noumeroi
							target = prev
						}
					}					
				}
			}	
		}
	}
}

#############################################
# ROMAN ADMIN INSTITUTION SCRIPTED GUI		#
#############################################

## Trigger Check for the gui file to see if you can see the roman army institution
am_institutions_roman_administration_can_see_roman_administration = {
	scope = character

	is_shown = {
		exists = this
		OR = {
			primary_title = {
				this = title:e_byzantium
			}
			any_liege_or_above = {
				primary_title = {
					this = title:e_byzantium
				}
			}
		}
	}
}

## Create the administrative officials variable list when you click on a gui button to display the administrative visually
am_institutions_roman_administration_get_administrative_officials_list = {
	scope = character
	
	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			## Clear variable always before
			clear_variable_list = list_roman_administration_administrative_officials
			clear_variable_list = list_roman_administration_administrative_officials_minus_high_officials
			clear_variable_list = list_roman_administration_high_administration_officials

			## All the administrative officials
			every_vassal = {
				limit = {
					roman_administration_holds_military_title_trigger = no
					highest_held_title_tier >= tier_duchy
					NOT = { has_government = theocracy_government }
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_administrative_officials
						target = prev
					}
				}				
			}
			## provincial administrative officials
			every_vassal = {
				limit = {
					roman_administration_holds_military_title_trigger = no
					roman_administration_holds_high_administration_title_trigger = no
					highest_held_title_tier >= tier_duchy
					NOT = { has_government = theocracy_government }
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_administrative_officials_minus_high_officials
						target = prev
					}
				}				
			}
			## Only High Administration officials
			every_vassal = {
				limit = {
					roman_administration_holds_high_administration_title_trigger = yes
				}
				root = {
					add_to_variable_list = {
						name = list_roman_administration_high_administration_officials
						target = prev
					}
				}				
			}
		}
		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}				
			}
			

			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_administrative_officials
				clear_variable_list = list_roman_administration_administrative_officials_minus_high_officials
				clear_variable_list = list_roman_administration_high_administration_officials

				## All the administrative officials
				every_vassal = {
					limit = {
						roman_administration_holds_military_title_trigger = no
						highest_held_title_tier >= tier_duchy
						NOT = { has_government = theocracy_government }
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_administrative_officials
							target = prev
						}
					}				
				}
				## provincial administrative officials
				every_vassal = {
					limit = {
						roman_administration_holds_military_title_trigger = no
						roman_administration_holds_high_administration_title_trigger = no
						highest_held_title_tier >= tier_duchy
						NOT = { has_government = theocracy_government }
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_administrative_officials_minus_high_officials
							target = prev
						}
					}				
				}
				## Only High Administration officials
				every_vassal = {
					limit = {
						roman_administration_holds_high_administration_title_trigger = yes
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_high_administration_officials
							target = prev
						}
					}				
				}
			}
		}
	}

}

am_institutions_roman_administration_get_sakellion_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_sakellion

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_sakellion
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_sakellion
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_sakellion

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_sakellion
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_sakellion
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_logothetetes_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_logothetetes

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_logothetetes_tou_dromou
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_logothetetes
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_logothetetes

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_logothetetes_tou_dromou
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_logothetetes
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_roman_administration_get_quaestor_list = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_byzantium
					}
				}				
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_quaestor

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_quaestor
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_quaestor
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_byzantium
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_byzantium
						}
					}				
				}
			}
			title:e_byzantium.holder = {
				## Clear variable always before
				clear_variable_list = list_roman_administration_quaestor

				every_vassal = {
					limit = {
						primary_title = {
							this = title:d_quaestor
						}
					}
					root = {
						add_to_variable_list = {
							name = list_roman_administration_quaestor
							target = prev
						}
					}					
				}
			}	
		}
	}
}

#############################################
# LEGITIMACY & POPULARITY SCRIPTED GUI		#
#############################################

### LEGITIMACY AND POPULARITY RELATED SCRIPTED GUI
am_roman_administration_has_popularity = {
	scope = character

	is_shown = {
		exists = this
		has_variable = roman_administration_popularity
	}
}

am_roman_administration_has_legitimacy = {
	scope = character

	is_shown = {
		exists = this
		has_variable = roman_administration_legitimacy		
	}
}


## ORC GUI TO DISPLAY DISTANCE TO CAPITAL
# am_orc_county_distance_to_capital = {
# 	set_variable = { 
# 		name = am_orc_county_distance_to_capital_info
# 		value = var:am_comm_malus_to_capital
# 	}
# }

#############################################
# ISLAMIC EMPIRE SCRIPTED GUI				#
#############################################

## Checks
am_islamic_empire_has_asabiyya = {
	scope = character

	is_shown = {
		exists = this
		is_ruler = yes
		primary_title = {
			has_variable = islamic_empire_asabiyya		
		}
		
	}
}

am_islamic_empire_has_authority = {
	scope = character

	is_shown = {
		exists = this
		has_variable = islamic_empire_authority
		
	}
}

am_institutions_islamic_empire_can_see_fatimid_army_factions = {
	scope = character

	is_shown = {
		exists = this
		OR = {
			primary_title = {
				this = title:e_egypt
			}
			any_liege_or_above = {
				primary_title = {
					this = title:e_egypt
				}
			}
		}
	}
}

am_institutions_islamic_empire_can_click_fatimid_army_factions_buttons = {
	scope = character

	is_shown = {
		exists = this
		any_held_title = {
			this = title:e_egypt
		}
	}
}

am_institutions_normal_councillors = {
	scope = character
	is_shown = {
		exists = this
		NOT = {			
			AND = {
				has_government = islamic_empire_government
				has_religion = religion:islam_religion
			}
		}		
	}
}

am_institutions_islamic_empire_muslim_councillors = {
	scope = character
	is_shown = {
		exists = this
		has_government = islamic_empire_government
		has_religion = religion:islam_religion
		#highest_held_title_tier >= tier_duchy
	}
}

am_institutions_islamic_empire_can_have_diwan = {
	scope = character
	is_shown = {
		exists = this
		has_religion = religion:islam_religion
		highest_held_title_tier >= tier_kingdom
		
	}
}

## Generate lists of character
am_institutions_islamic_empire_fatimid_get_army_leaders = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_egypt
					}
				}				
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_army_leaders

				every_vassal = {
					limit = {
						OR = {
							primary_title = { this = title:d_kutama }
							has_government = islamic_empire_regiment_government
						}
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_army_leaders
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_egypt
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_egypt
						}
					}				
				}
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_army_leaders

				every_vassal = {
					limit = {
						OR = {
							has_government = clan_government
							has_government = islamic_empire_regiment_government
						}
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_army_leaders
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_islamic_empire_fatimid_get_diwan_leaders = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_egypt
					}
				}				
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_diwan_leaders

				every_vassal = {
					limit = {
						has_government = islamic_empire_diwan_government
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_diwan_leaders
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_egypt
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_egypt
						}
					}				
				}
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_diwan_leaders

				every_vassal = {
					limit = {
						has_government = islamic_empire_diwan_government
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_diwan_leaders
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_institutions_islamic_empire_fatimid_get_dawa_leaders = {
	scope = character

	effect = {
		if = {
			limit = {
				root = {
					primary_title = {
						this = title:e_egypt
					}
				}				
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_dawa_leaders

				every_vassal = {
					limit = {
						has_government = theocracy_government
						highest_held_title_tier >= tier_duchy
						faith = faith:ismaili
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_dawa_leaders
							target = prev
						}
					}					
				}
			}
		}

		if = {
			limit = {
				root = {
					NOT = {
						primary_title = {
							this = title:e_egypt
						}
					}	
					any_liege_or_above = {
						primary_title = {
							this = title:e_egypt
						}
					}				
				}
			}
			title:e_egypt.holder = {
				## Clear variable always before
				clear_variable_list = list_fatimid_dawa_leaders

				every_vassal = {
					limit = {
						has_government = theocracy_government
						highest_held_title_tier >= tier_duchy
						faith = faith:ismaili
					}
					root = {
						add_to_variable_list = {
							name = list_fatimid_dawa_leaders
							target = prev
						}
					}					
				}
			}	
		}
	}
}

am_islamic_empire_wazir_candidates = {
	scope = character
	effect = {
		clear_variable_list = list_am_islamic_empire_wazir_candidates
		every_vassal = {
			root = {
				add_to_variable_list = {
					name = list_am_islamic_empire_wazir_candidates
					target = prev
				}
			}	
		}
	}
}

## Fatimid faction size/salary/honors/troops increase/decrease
am_institutions_islamic_empire_fatimid_faction_increase_size = {
	scope = character

	effect = {
		save_scope_as = regiment_leader
		liege = {
			trigger_event = {
				id = ave_maria_ghulam_events.0002
			}
		}		
	}
}

am_institutions_islamic_empire_fatimid_faction_decrease_size = {
	scope = character

	effect = {
		liege = {
			trigger_event = {
				id = ave_maria_ghulam_events.0002
			}
		}	
	}
}

am_institutions_islamic_empire_fatimid_faction_increase_salary = {
	scope = character
	effect = {
		save_scope_as = regiment_leader
		scope:regiment_leader = {
			primary_title = {
				save_scope_as = regiment_title
			}
			islamic_empire_remove_salary_income = yes 
		}
		primary_title = {
			#save_scope_as = regiment_title
			change_variable = {
				name = islamic_empire_regiment_salary
				add = 0.5
			}
			#islamic_empire_apply_salary_income = yes
		}
		add_opinion = {
			modifier = islamic_empire_increased_salary
			target = liege
		}
		islamic_empire_apply_salary_opinion = yes
		liege = {
			islamic_empire_calculate_regiment_cost = yes
			trigger_event = {
				id = ave_maria_ghulam_events.0002
			}
		}		
	}
}

am_institutions_islamic_empire_fatimid_faction_decrease_salary = {
	scope = character
	effect = {
		save_scope_as = regiment_leader
		scope:regiment_leader = {
			primary_title = {
				save_scope_as = regiment_title
			}
			#islamic_empire_remove_salary_income = yes 
		}
		primary_title = {
			#save_scope_as = regiment_title
			change_variable = {
				name = islamic_empire_regiment_salary
				subtract = 0.5
			}
			islamic_empire_apply_salary_income = yes
		}
		add_opinion = {
			modifier = islamic_empire_decreased_salary
			target = liege
		}
		islamic_empire_apply_salary_opinion = yes
		liege = {
			islamic_empire_calculate_regiment_cost = yes
			trigger_event = {
				id = ave_maria_ghulam_events.0003
			}
		}		
	}
}

am_institutions_islamic_empire_fatimid_faction_bestow_honors = {
	scope = character
	effect = {
		save_scope_as = regiment_leader
		primary_title = {
			save_scope_as = regiment_title
		}
		liege = {
			trigger_event = {
				id = ave_maria_honours_events.0001
			}
		}		
	}
}

am_institutions_islamic_empire_fatimid_faction_increase_infantry = {
	scope = character
	effect = {
		root = {
			primary_title = {
				change_variable = {
					name = islamic_empire_regiment_size_infantry
					add = 1
				}
				change_variable = {
					name = islamic_empire_regiment_size_infantry_display
					add = 100
				}
				change_variable = {
					name = islamic_empire_regiment_size_total_display
					add = 100
				}
			}	
			liege = {
				islamic_empire_calculate_regiment_cost = yes
				remove_short_term_gold = 90
			}
		}
		
	}
}

am_institutions_islamic_empire_fatimid_faction_decrease_infantry = {
	scope = character
	effect = {
		root = {
			if = {
				limit = {
					is_ruler = yes
					is_independent_ruler = no
				}
				primary_title = {
					if = {
						limit = {
							var:islamic_empire_regiment_size_infantry >= 0
						}
					}
					else = {
						primary_title = {
							change_variable = {
								name = islamic_empire_regiment_size_infantry
								subtract = 1
							}
							change_variable = {
								name = islamic_empire_regiment_size_infantry_display
								subtract = 100
							}
							change_variable = {
								name = islamic_empire_regiment_size_total_display
								subtract = 100
							}
						}	
						liege = {
							islamic_empire_calculate_regiment_cost = yes
							add_gold = 40
						}
					}
				}	
			}
			
		}			
		
	}
}

am_institutions_islamic_empire_fatimid_faction_increase_light_cavalry = {
	scope = character
	effect = {
		root = {
			primary_title = {
				change_variable = {
					name = islamic_empire_regiment_size_light_cavalry
					add = 1
				}
				change_variable = {
					name = islamic_empire_regiment_size_light_cavalry_display
					add = 100
				}
				change_variable = {
					name = islamic_empire_regiment_size_total_display
					add = 100
				}
			}	
			liege = {
				islamic_empire_calculate_regiment_cost = yes
				remove_short_term_gold = 85
			}
		}		
	}
}

am_institutions_islamic_empire_fatimid_faction_decrease_light_cavalry = {
	scope = character
	effect = {
		root = {
			if = {
				limit = {
					is_ruler = yes
					is_independent_ruler = no
				}
				primary_title = {
					if = {
						limit = {
							var:islamic_empire_regiment_size_light_cavalry >= 0
						}
					}
					else = {
						primary_title = {
							change_variable = {
								name = islamic_empire_regiment_size_light_cavalry
								subtract = 1
							}
							change_variable = {
								name = islamic_empire_regiment_size_light_cavalry_display
								subtract = 100
							}
							change_variable = {
								name = islamic_empire_regiment_size_total_display
								subtract = 100
							}
						}	
						liege = {
							islamic_empire_calculate_regiment_cost = yes
							add_gold = 40
						}
					}
				}	
			}
			
		}
			
		
	}
}

am_institutions_islamic_empire_fatimid_faction_increase_heavy_cavalry = {
	scope = character
	effect = {
		root = {
			primary_title = {
				change_variable = {
					name = islamic_empire_regiment_size_heavy_cavalry
					add = 1
				}
				change_variable = {
					name = islamic_empire_regiment_size_heavy_cavalry_display
					add = 50
				}
				change_variable = {
					name = islamic_empire_regiment_size_total_display
					add = 50
				}
			}	
			liege = {
				islamic_empire_calculate_regiment_cost = yes
				remove_short_term_gold = 260
			}
		}
		
	}
}

am_institutions_islamic_empire_fatimid_faction_decrease_heavy_cavalry = {
	scope = character
	effect = {
		root = {
			if = {
				limit = {
					is_ruler = yes
					is_independent_ruler = no
				}
				primary_title = {
					if = {
						limit = {
							var:islamic_empire_regiment_size_heavy_cavalry >= 0
						}
					}
					else = {
						primary_title = {
							change_variable = {
								name = islamic_empire_regiment_size_heavy_cavalry
								subtract = 1
							}
							change_variable = {
								name = islamic_empire_regiment_size_heavy_cavalry_display
								subtract = 50
							}
							change_variable = {
								name = islamic_empire_regiment_size_total_display
								subtract = 50
							}
						}	
						liege = {
							islamic_empire_calculate_regiment_cost = yes
							add_gold = 75
						}
					}
				}
			}
				
		}
		
	}
}






#############################################
# ORC SCRIPTED GUI							#
#############################################

am_orc_comm_malus_capital_update = {
	scope = character

	effect = {
		root = {
			if = {
				limit = {
					is_landed = yes
				}
				trigger_event = {
					id = ave_maria_opus_ruralium_commodorum.0001 
					#delayed = yes 
					days = 1
				}
			}
		}
		
	}
	
}


am_orc_comm_malus_capital_update_2 = {
	scope = title

	effect = {
		holder = {
			if = {
				limit = {
					is_landed = yes
				}
				set_realm_capital = root
				trigger_event = { id = ave_maria_opus_ruralium_commodorum.0001 delayed = yes}
			}
		}
		
	}
	
}

