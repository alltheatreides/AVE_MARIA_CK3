# Called from code after history generation
# Empty scope
on_game_start = {
	events = {
		fp1_scandinavian_adventurers.0004	# FP1 - Organise Norse adventurers.
		fp1_scandinavian_adventurers.0011	# FP1 - Corral famous Norse adventurers that haven't done much yet.
		fp1_scandinavian_adventurers.0021	# FP1 - Mark game-start prioritised adventurers.
	}

	effect = {
		### 867 - WRATH OF THE NORTHMEN ###
		#Æthelred dying (probably)
		character:33358 = {
			if = {
				limit = {
					is_alive = yes
					is_landed = yes
				}
				trigger_event = {
					id = bookmark.0001
					days = { 365 730 }
				}
			}
		}

		#Alfred the Great becoming the Great
		character:7627 = {
			if = {
				limit = {
					is_alive = yes
					is_landed = yes
				}
				trigger_event = {
					id = bookmark.0002
					days = 1800 #~5 years
				}
			}
		}

		### 867 - THE GREAT ADVENTURERS ###
		character:251187 = {
			if = {
				limit = {
					is_alive = yes
					is_landed = yes
					AND = {
						character:251180 = { is_ai = yes }
						character:251181 = {
							is_ai = yes
							is_alive = yes
						}
					}
				}
				trigger_event = {
					id = bookmark.0101
					days = { 21 35 }
				}
			}
		}

		### HRE SETUP ###
		if = {
			limit = { exists = title:e_hre.holder }
			title:e_hre.holder = {
				every_vassal = {
					limit = {
						vassal_contract_has_modifiable_obligations = yes
					}
					vassal_contract_decrease_obligation_level = feudal_government_taxes
					vassal_contract_decrease_obligation_level = feudal_government_levies
				}
			}
		}

		#Set up Visigothic Codes.
		culture:occitan = { add_innovation = innovation_visigothic_codes }
		culture:basque = { add_innovation = innovation_visigothic_codes }
		culture:aragonese = { add_innovation = innovation_visigothic_codes }
		culture:catalan = { add_innovation = innovation_visigothic_codes }

		### RELIGIOUS THINGS ###
		religion:islam_religion = { # Set up Holy Site Buildings to be buildable in Holy Sites
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_mosque_01
					}
				}
			}
		}
		
		religion:christianity_religion = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_cathedral_01
					}
				}
			}
		}
		
		faith:old_bon = { # Has already been reformed into new bon.
			set_variable = { name = has_been_reformed }
		}

		every_religion_global = {
			limit = {
				OR = {
					this = religion:hinduism_religion
					this = religion:buddhism_religion
					this = religion:jainism_religion
					this = religion:tani_religion
					this = religion:bon_religion
				}
			}
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_indian_grand_temple_01
					}
				}
			}
		}
		
		every_religion_global = {
			limit = {
				is_in_family = rf_pagan
			}
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_pagan_grand_temple_01
					}
				}
			}
		}
		
		every_religion_global = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_other_grand_temple_01
					}
				}
			}
		}
		if = {
			limit = {
				game_start_date <= 1000.1.1
			}
			title:e_scandinavia = { set_coa = e_scandinavia_norse }
			title:k_sweden = { set_coa = k_sweden_norse }
			title:d_svealand = { set_coa = d_svealand_norse }
			title:c_upland = { set_coa = c_upland_norse }
			title:c_gastrikland = { set_coa = c_gastrikland_norse }
			title:c_sodermannaland = { set_coa = c_sodermannaland_norse }
			title:c_aland = { set_coa = c_aland_norse }
			title:d_bergslagen = { set_coa = d_bergslagen_norse }
			title:c_vastmanland = { set_coa = c_vastmanland_norse  }
			title:c_varmland = { set_coa = c_varmland_norse }
			title:c_dalarna = { set_coa = c_dalarna_norse }
			title:c_dalabergslagen = { set_coa = c_dalabergslagen_norse }
			title:d_vastergotland = { set_coa = d_vastergotland_norse }
			title:c_vastergotland = { set_coa = c_vastergotland_norse }
			title:c_skara = { set_coa = c_skara_norse }
			title:c_dal = { set_coa = c_dal_norse }
			title:c_nordmark = { set_coa = c_nordmark_norse }
			title:d_ostergotland = { set_coa = d_ostergotland_norse }
			title:c_ostergotland = { set_coa = c_ostergotland_norse }
			title:c_kinda = { set_coa = c_kinda_norse }
			title:c_narke = { set_coa = c_narke_norse }
			title:d_smaland = { set_coa = d_smaland_norse }
			title:c_more = { set_coa = c_more_norse }
			title:c_sevede = { set_coa = c_sevede_norse }
			title:c_varend = { set_coa = c_varend_norse }
			title:c_njudung = { set_coa = c_njudung_norse }
			title:c_finnveden = { set_coa = c_finnveden_norse }
			title:c_oland = { set_coa = c_oland_norse }
			title:d_norrland = { set_coa = d_norrland_norse }
			title:c_halsingland = { set_coa = c_halsingland_norse }
			title:c_medelpad = { set_coa = c_medelpad_norse }
			title:c_angermanland = { set_coa = c_angermanland_norse }
			title:d_gotland = { set_coa = d_gotland_norse }
			title:c_gutland = { set_coa = c_gutland_norse }
			title:k_norway = { set_coa = k_norway_norse }
			title:d_viken = { set_coa = d_viken_norse }
			title:c_vingulmork = { set_coa = c_vingulmork_norse }
			title:c_raniriki = { set_coa = c_raniriki_norse }
			title:c_vestfold = { set_coa = c_vestfold_norse }
			title:c_telemark = { set_coa = c_telemark_norse }
			title:d_agder = { set_coa = d_agder_norse }
			title:c_nedenes = { set_coa = c_nedenes_norse }
			title:c_agdeside = { set_coa = c_agdeside_norse }
			title:d_vestlandi = { set_coa = d_vestlandi_norse }
			title:c_rogalandi = { set_coa = c_rogalandi_norse }
			title:c_hordalandi = { set_coa = c_hordalandi_norse }
			title:c_sogn = { set_coa = c_sogn_norse }
			title:d_trandalog = { set_coa = d_trandalog_norse }
			title:c_trandheim = { set_coa = c_trandheim_norse }
			title:c_norwegian_more = { set_coa = c_norwegian_more_norse }
			title:c_firdafylki = { set_coa = c_firdafylki_norse }
			title:d_dalir = { set_coa = d_dalir_norse }
			title:c_hedmork = { set_coa = c_hedmork_norse }
			title:c_gudbrandsdalir = { set_coa = c_gudbrandsdalir_norse }
			title:c_eystridalir = { set_coa = c_eystridalir_norse }
			title:c_gauldala = { set_coa = c_gauldala_norse }
			title:d_halogaland = { set_coa = d_halogaland_norse }
			title:c_vastvag = { set_coa = c_vastvag_norse }
			title:c_bothin = { set_coa = c_bothin_norse }
			title:c_namdalfylki = { set_coa = c_namdalfylki_norse }
			title:d_iceland = { set_coa = d_iceland_norse }
			title:c_vestisland = { set_coa = c_vestisland_norse }
			title:c_nordrland = { set_coa = c_nordrland_norse }
			title:c_austisland = { set_coa = c_austisland_norse }
			title:c_sudurland = { set_coa = c_sudurland_norse }
			title:d_northern_isles = { set_coa = d_northern_isles_norse }
			title:c_orkney = { set_coa = c_orkney_norse }
			title:c_faereyar = { set_coa = c_faereyar_norse }
			title:c_shetland = { set_coa = c_shetland_norse }
			title:d_jamtland = { set_coa = d_jamtland_norse }
			title:c_jamtfir = { set_coa = c_jamtfir_norse }
			title:c_morarna = { set_coa = c_morarna_norse }
			title:c_helgum = { set_coa = c_helgum_norse }
			title:c_harjadalen = { set_coa = c_harjadalen_norse }
			title:k_denmark = { set_coa = k_denmark_norse }
			title:d_sjaelland = { set_coa = d_sjaelland_norse }
			title:c_sjaelland = { set_coa = c_sjaelland_norse }
			title:c_fyn = { set_coa = c_fyn_norse }
			title:c_lolland_falster = { set_coa = c_lolland_falster_norse }
			title:d_skane = { set_coa = d_skane_norse }
			title:c_skane = { set_coa = c_skane_norse }
			title:c_halland = { set_coa = c_halland_norse }
			title:c_bornholm = { set_coa = c_bornholm_norse }
			title:c_blekinge = { set_coa = c_blekinge_norse }
			title:d_jylland = { set_coa = d_jylland_norse }
			title:c_aarhus = { set_coa = c_aarhus_norse }
			title:c_viborg = { set_coa = c_viborg_norse }
			title:c_ringkobing = { set_coa = c_ringkobing_norse }
			title:c_aalborg = { set_coa = c_aalborg_norse }
			title:d_slesvig = { set_coa = d_slesvig_norse }
			title:c_slesvig = { set_coa = c_slesvig_norse }
			title:c_vorbasse = { set_coa = c_vorbasse_norse }
			title:c_ribe = { set_coa = c_ribe_norse }
			title:d_york = { set_coa = d_york_norse }
			title:c_east_riding = { set_coa = c_east_riding_norse }
			title:d_western_isles = { set_coa = d_western_isles_norse }
			title:c_inner_hebrides = { set_coa = c_inner_hebrides_norse  }
			title:c_dublin = { set_coa = c_dublin_norse }
			title:c_argyll = { set_coa = c_argyll_norse }
		}
	}
}

# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
on_game_start_after_lobby = {
	effect = {
		### GAME RULE: VIEW ON SAME-SEX RELATIONS
		if = {
			limit = { has_game_rule = accepted_same_sex_relations }
			game_rule_accepted_same_sex_relations_effect = yes
		}

		### GAME RULE: RANDOM RULER PLACEMENT
		if = {
			limit = { NOT = { has_game_rule = random_ruler_placement_off } }
			game_rule_random_ruler_placement_effect = yes
		}

		### GAME RULE: RANDOMIZE FAITH
		if = {
			limit = { has_game_rule = randomized_faiths_on }
			game_rule_randomize_faith_effect = yes
		}

		### GAME RULE: FAITH ACCEPTANCE
		if = {
			limit = { has_game_rule = full_faith_acceptance }
			game_rule_faith_acceptance_effect = yes
		}

		### GAME RULE: GENDER EQUALITY ###
		if = {
			limit = { has_game_rule = full_gender_equality }
			game_rule_full_gender_equality_effect = yes
		}
		else_if = {
			limit = { has_game_rule = inversed_gender_equality }
			game_rule_inversed_gender_equality_effect = yes #todo fix
		}

		### GAME RULE: SEXUALITY DISTRIBUTION ###
		if = {
			limit = { NOT = { has_game_rule = sexuality_distribution_default } }
			game_rule_sexuality_distribution_effect = yes
		}

		### ACHIEVEMENT: FROM RAGS TO RICHES
		every_player = {
			limit = { highest_held_title_tier = tier_county }
			add_achievement_global_variable_effect = {
				VARIABLE = achievement_rags_to_riches_valid
				VALUE = yes
			}
		}
		### ACHIEVEMENT TRACKING FOR STARTING CHARACTERS
		if = { 
			limit = { has_multiple_players = no }
			every_player = { 
				# Base Title
				if = {
					limit = { 
						exists = character:7757
						this = character:7757
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_give_a_dog_a_bone_achievement
						VALUE = yes
					}
				}	
				if = {
					limit = { 
						exists = character:1128
						this = character:1128
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_wily_as_the_fox_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								exists = character:108501
								this = character:108501
							}
							AND = {
								exists = character:107500
								this = character:107500
							}
							AND = {
								exists = character:107501
								this = character:107501
							}
							AND = {
								exists = character:108500
								this = character:108500
							}
							AND = {
								exists = character:109500
								this = character:109500
							}
						}
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_sibling_rivalry_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								exists = character:163108
								this = character:163108
							}
							AND = {
								exists = character:163110
								this = character:163110
							}
							AND = {
								exists = character:163111
								this = character:163111
							}
							AND = {
								exists = character:163112
								this = character:163112
							}
							AND = {
								exists = character:163119
								this = character:163119
							}
						}
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_blood_eagle_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						exists = character:6448
						this = character:6448
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_kings_to_the_seventh_generation_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						exists = character:140
						this = character:140
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_norman_yoke_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						exists = character:522
						this = character:522
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_royal_dignity_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						exists = character:40605
						this = character:40605
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_land_of_the_rus_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						exists = character:251187
						this = character:251187
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_mother_of_us_all_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						OR = {
							culture_group = culture_group:iberian_group
							culture = culture:andalusian
						}
						has_religion = religion:christianity_religion
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_reconquista_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						culture = culture:irish
						capital_province = { geographical_region = custom_ireland }
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_the_emerald_isle_achievement
						VALUE = yes
					}
				}
				if = {
					limit = {
						OR = {
							culture = culture:castilian
							culture = culture:basque
							culture = culture:portuguese
							culture = culture:catalan
							culture = culture:andalusian
							culture = culture:visigothic
							culture = culture:suebi
						}
						has_religion = religion:islam_religion
						capital_province = { geographical_region = world_europe_west_iberia }
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_al_andalus_achievement
						VALUE = yes
					}
				}
				if = {
					limit = { 
						exists = character:159137
						this = character:159137
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_almost_there_achievement
						VALUE = yes
					}
				}
				if = {
					limit = { 
						exists = character:109607
						this = character:109607
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_last_count_first_king_achievement
						VALUE = yes
					}
				}
				if = {
					limit = { 
						exists = character:6878
						this = character:6878
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_going_places_achievement
						VALUE = yes
					}
				}
				# FP1
				# far_from_home_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse-cultured character.
						fp1_achievement_culture_plus_religion_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_far_from_home_achievement
						VALUE = yes
					}
				}
				# miklagardariki_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse-cultured character.
						fp1_achievement_culture_plus_religion_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_miklagardariki_achievement
						VALUE = yes
					}
				}
				# canute_the_greater_achievement
				if = {
					limit = {
						## DLC check.
						has_fp1_dlc_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_canute_the_greater_achievement
						VALUE = yes
					}
				}
				# king_of_all_the_isles_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse-cultured character.
						fp1_achievement_culture_plus_religion_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_king_of_all_the_isles_achievement
						VALUE = yes
					}
				}
				# faster_than_the_fox_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse-cultured character.
						fp1_achievement_culture_plus_religion_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_faster_than_the_fox_achievement
						VALUE = yes
					}
				}
				# volva_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse-cultured character.
						fp1_achievement_culture_plus_religion_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_volva_achievement
						VALUE = yes
					}
				}
				# saga_in_stone_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_saga_in_stone_achievement
						VALUE = yes
					}
				}
				# first_of_the_crusader_kings_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse-cultured character.
						fp1_achievement_culture_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_first_of_the_crusader_kings_achievement
						VALUE = yes
					}
				}
				# vladimirs_second_choice_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
						# Starting as a Norse pagan Norse or Rus-cultured character.
						fp1_achievement_culture_norse_or_rus_trigger = yes
						fp1_achievement_religious_norse_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_vladimirs_second_choice_achievement
						VALUE = yes
					}
				}
				# a_dangerous_business_achievement
				if = {
					limit = {
						# DLC check.
						has_fp1_dlc_trigger = yes
					}
					add_achievement_global_variable_effect = {
						VARIABLE = started_a_dangerous_business_achievement
						VALUE = yes
					}
				}
			
				### RULER DESIGNER ACHIEVEMENT BLOCKS ###
				if = {
					limit = {
						num_virtuous_traits >= 3
					}
					add_achievement_flag_effect = { FLAG = rd_character_blocked_paragon_of_virtue_achievement_flag	}	
				}
				if = {
					limit = {
						any_child = {
							count >= 10
							is_alive = yes
						}
					}
					add_achievement_flag_effect = { FLAG = rd_character_blocked_the_succession_is_safe_achievement_flag }	
				}
				if = {
					limit = {
						any_child = {
							has_trait = inbred
						}	
					}
					add_achievement_flag_effect = { FLAG = rd_character_blocked_keeping_it_in_the_family_achievement_flag }
				}
				if = {
					limit = {
						highest_held_title_tier >= tier_empire
						should_be_naked_trigger = yes	
					}
					add_achievement_flag_effect = { FLAG = rd_character_blocked_the_emperors_new_clothes_achievement_flag }
				}
				if = {
					limit = {
						is_from_ruler_designer = yes
						OR = {
							fp1_achievement_culture_norse_trigger = yes
							fp1_achievement_religious_norse_trigger = yes
						}
					}
					add_to_global_unavailable_achievements_list_effect = { FLAG = flag:rd_character_blocked_far_from_home_achievement }
					add_to_global_unavailable_achievements_list_effect = { FLAG = flag:rd_character_blocked_miklagardariki_achievement }
					add_to_global_unavailable_achievements_list_effect = { FLAG = flag:rd_character_blocked_faster_than_the_fox_achievement }
				}
			}
		}


		#############################################
		# AVE MARIA EFFECTS							#
		#############################################

		### KJH Distance Calculator
		init_main = yes

		### OPUS RURALIUM COMMODORUM
		every_ruler = {
			limit = {
				is_landed = yes
			}
			orc_apply_demesne_provinces_distance_malus = yes
		}

		## HEXACO
		hexaco_game_start_setup = yes

		## Roman Administration
		title:e_byzantium.holder = {
			trigger_event = ave_maria_roman_administration_events.0001
			
			#trigger_event = { id = ave_maria_utility_events.0001 days = 1 }
	
			## Set up emperor legitimacy
			#roman_administration_update_legitimacy_variable = yes
			set_variable = {
				name = roman_administration_legitimacy_monthly_display
				value = roman_administration_legitimacy_monthly
			}
			set_variable = {
				name = roman_administration_popularity_monthly_display
				value = roman_administration_popularity_monthly
			}
	
			## Set up emperor popularity
			#roman_administration_update_popularity_variable = yes
	
			## Distribute legitimacy
			roman_administration_game_start_legitimacy_distribution = yes
	
			## Terms of office event chain start up
			#roman_administration_game_start_vassal_terms_of_office_setup = yes
	
			## Office salary indicator for high officials
			roman_administration_game_start_vassal_salary_modifier_setup = yes

			
			## Update the Salary cost Tax Income negative modifier for the emperor
			roman_administration_update_total_salary_cost = yes

			## converting non roman vassals
			every_vassal = {
				if = {
					limit = { uses_roman_govt = no NOT = { has_government = theocracy_government } }
					change_government = roman_administration_government
				}
				every_vassal = {
					if = {
						limit = { uses_roman_govt = no NOT = { has_government = theocracy_government } }
						change_government = roman_administration_government
					}					
				}
			}

			## adding important title holders in global list and handing out popularity/legitimacy
			every_vassal = {
				if = {
					limit = {
						roman_administration_holds_tagma_title_trigger = yes
					}
					primary_title = {
						add_to_global_variable_list = {
							name = roman_administration_tagma_list
							target = this
						}
					}
					roman_administration_update_popularity_variable = yes
				}
				if = {
					limit = {
						roman_administration_holds_high_administration_title_trigger = yes
					}
					primary_title = {
						add_to_global_variable_list = {
							name = roman_administration_sekreton_list
							target = this
						}
					}
					roman_administration_update_popularity_variable = yes
				}
				if = {
					limit = {
						any_held_title = {
							OR = {
								this = title:d_antioch
								this = title:d_vaspurakan
								this = title:d_greater_armenia
								this = title:d_mesopotamia
								this = title:d_bulgaria
								this = title:d_turnovo
								this = title:d_langobardia_roman
							}
						}
					}
					roman_administration_update_popularity_variable = yes
					primary_title = {
						add_to_global_variable_list = {
							name = roman_administration_doukaton_list
							target = this
						}
						set_variable = {
							name = roman_administration_doukaton_title
							value = yes
						}
					}
				}
				if = {
					limit = {
						any_held_title = {
							OR = {
								this = title:d_thrace
							}
						}
					}
					primary_title = {
						add_to_global_variable_list = {
							name = roman_administration_kouratoreia_list
							target = this
						}
						set_variable = {
							name = roman_administration_kouratoreia_title
							value = yes
						}
					}
				}
			}

			## vassal contracts
			every_vassal = {
				if = {
					limit = {
						highest_held_title_tier >= tier_duchy
					}
					set_variable = {
						name = roman_administration_contract_level_tax
						value = vassal_contract_obligation_level:imperial_obligation_tax
					}
					set_variable = {
						name = roman_administration_contract_level_special_contract
						value = vassal_contract_obligation_level:ave_maria_roman_administration_special_contract
					}

					if = {
						limit = {
							has_government = roman_administration_doukaton_government
						}
						set_variable = {
							name = roman_administration_contract_level_doukaton
							value = vassal_contract_obligation_level:imperial_obligation_doukaton
						}
					}
					if = {
						limit = {
							has_government = roman_administration_theme_government
						}
						set_variable = {
							name = roman_administration_contract_level_theme
							value = vassal_contract_obligation_level:imperial_obligation_theme
						}
					}
					if = {
						limit = {
							has_government = roman_administration_kouratoreia_government
						}
						set_variable = {
							name = roman_administration_contract_level_kouratoreia
							value = vassal_contract_obligation_level:imperial_obligation_kouratoreia
						}
					}
				}				
			}
		}

		title:e_byzantium = {
			set_variable = {
				name = roman_administration_tagmatic_doukaton_limit
				value = 2
			}
		}

		## Seljuk Byzantine War - 1066
		if = {
			limit = {
				current_date = 1066.9.15
			}
			title:e_persia.holder = {
				# trigger_event = { id = ave_maria_roman_administration_start_up_events.0001 days = 1 }
				start_war = {
					cb = invasion_war
					target = character:1732
					target_title = k_armenia
				}
				every_character_war = {
					add_attacker = title:d_edessa.holder
					add_attacker = title:d_diyarrabia.holder
					add_attacker = title:d_aleppo.holder
					add_attacker = title:d_azerbaijan.holder
				}
			}
		}
		
		## Norman Byzantine War - 1081
		if = {
			limit = {
				current_date = 1081.4.1
			}
			title:d_apulia.holder = {
				start_war = {
					cb = invasion_war
					target = character:1742
					target_title = k_epirus
				}
				every_character_war = {
					add_attacker = character:1132
				}
			}
		}

		## ISLAMIC EMPIRES
		## FATIMIDS
		title:e_egypt = {
			set_variable = {
				name = islamic_empire_title
				value = yes
			}

			add_to_global_variable_list = { name = islamic_empire_faction_ascendency_title target = this }
			islamic_empire_apply_faction_ascendency_modifier = { INSTITUTION = army }
			islamic_empire_apply_faction_ascendency_modifier = { INSTITUTION = diwan }

			holder = {
				add_pressed_claim = d_damascus
				add_pressed_claim = d_palestine

				islamic_empire_calculate_regiment_cost = yes

				every_vassal = {
					primary_title = {
						islamic_empire_apply_salary_income = yes
					}
					
					islamic_empire_apply_salary_opinion = yes

					## giving courtiers for title inheritance
					if = {
						limit = {
							highest_held_title_tier = tier_duchy
							uses_islamic_empire_govt = yes
							
						}
						create_character = {
							age = 25
							gender_female_chance = 0
							employer = this
							faith = faith:ismaili
							culture = this.culture
							random_traits_list = {
								count = 2
								calm = {}
								brave = {}
								gregarious = {}
								ambitious = {}
								stubborn = {}
								arrogant = {}
							}
							random_traits_list = {
								count = 1
								education_martial_3 = {}
								education_martial_4 = {}
							}
							random_traits_list = {
								count = 2
								brave = {}
								thorough = {}
							}
							martial = {
								min_template_decent_skill
								max_template_decent_skill
							}
							prowess = { 8 12 }
							after_creation = {
								add_random_hexaco_personality_trait = { WHO = this }
							
								#Chance of receiving an extra commander trait
								random = {
									chance = 25
									give_random_commander_trait_effect = yes
								}
							}
						}
						create_character = {
							age = 25
							gender_female_chance = 0
							employer = this
							faith = faith:ismaili
							culture = this.culture
							random_traits_list = {
								count = 2
								calm = {}
								brave = {}
								gregarious = {}
								ambitious = {}
								stubborn = {}
								arrogant = {}
							}
							random_traits_list = {
								count = 1
								education_martial_3 = {}
								education_martial_4 = {}
							}
							random_traits_list = {
								count = 2
								brave = {}
								thorough = {}
							}
							martial = {
								min_template_decent_skill
								max_template_decent_skill
							}
							prowess = { 8 12 }
							after_creation = {
								add_random_hexaco_personality_trait = { WHO = this }
							
								#Chance of receiving an extra commander trait
								random = {
									chance = 25
									give_random_commander_trait_effect = yes
								}
							}
						}
					}
					every_courtier = {
						limit = {
							is_female = no
							age >= 20
							OR = {
								has_trait = ghulam
								martial >= 12
							}						
						}
						add_unpressed_claim = prev.primary_title
					}

					if = {
						limit = {
							NOT = {
								has_government = clan_government
							}
						}
						trigger_event = { id = ave_maria_islamic_empire_game_start_events.0001 }
					}
				}
			}
		}
		title:d_damascus = {
			set_variable = {
				name = islamic_empire_amir_title
				value = yes
			}
		}
		title:d_palestine = {
			set_variable = {
				name = islamic_empire_amir_title
				value = yes
			}
		}

		# historical bad flood 
		province:6026 = {
			every_in_list = {
				variable = prov_port
				county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}
			}
		}
		province:6027 = {
			every_in_list = {
				variable = prov_port
				county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}
			}
		}
		province:6028 = {
			every_in_list = {
				variable = prov_port
				county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}
			}
		}
		province:6029 = {
			every_in_list = {
				variable = prov_port
				county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}
			}
		}
		province:6125 = {
			every_in_list = {
				variable = prov_port
				county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}
			}
		}
		## Nubia
		province:6329 = {
			county = {
				add_county_modifier = {
					modifier = islamic_empire_nile_flood_very_bad
					days = 150
				}
			}
		}	
		province:6331 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6330 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6332 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6333 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6334 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6335 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6336 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6337 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6338 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6339 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6340 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6359 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6341 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6342 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6343 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6344 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6345 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6346 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6360 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6348 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6347 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6349 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6368 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6367 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6369 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6351 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6352 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6370 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6353 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6355 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6357 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6358 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6356 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6363 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6365 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6364 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6391 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6392 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6395 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6396 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6366 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6390 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6393 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6429 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6401 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6432 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6430 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6433 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6400 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6404 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6405 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6406 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6394 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6392 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6397 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6398 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}			
		province:6399 = {			
			county = {
					add_county_modifier = {
						modifier = islamic_empire_nile_flood_very_bad
						days = 150
					}
				}		
		}	

		## ISLAMIC EMPIRE - Assigning asabiyya
		every_ruler = {
			limit = {
				OR = {
					has_government = clan_government
					has_government = tribal_government
				}
				religion = religion:islam_religion
			}
			primary_title = {
				set_variable = {
					name = islamic_empire_asabiyya
					value = 100
				}
				islamic_empire_asabiyya_level_calc = yes
			}
			add_to_global_variable_list = { name = islamic_empire_asabiyya_title_holder target = this }
		}

		## ISLAMIC EMPIRE - Vassal contracts for dhimmi
		every_ruler = {
			limit = {
				highest_held_title_tier >= tier_duchy
				has_religion = religion:islam_religion
			}
			every_vassal = {
				limit = {
					has_religion = religion:islam_religion
					OR = {
						NOT = {
							has_government = islamic_empire_diwan_government
						}
						NOT = {
							has_government = islamic_empire_regiment_government
						}
					}
				}
				vassal_contract_set_obligation_level = { type = islamic_empire_muslim_tax level = 3 }
			}
			every_vassal = {
				limit = {
					OR = {
						has_religion = religion:christianity_religion
						has_religion = religion:judaism_religion
					}
				}
				vassal_contract_set_obligation_level = { type = islamic_empire_non_muslim_tax level = 2 }
			}
		}
		## ISLAMIC EMPIRE - Getting the factional influence leaders for the list
		every_ruler = {
			limit = {
				is_alive = yes
				primary_title = {
					has_variable = islamic_empire_influence_internal_faction
				}
			}
			primary_title = {
				add_to_global_variable_list = { name = islamic_empire_faction_influence_title target = this }
				islamic_empire_apply_faction_influence_modifier = { FACTION = barid }
				islamic_empire_apply_faction_influence_modifier = { FACTION = insha }
				islamic_empire_apply_faction_influence_modifier = { FACTION = karaj }
				islamic_empire_apply_faction_influence_modifier = { FACTION = jays }
				islamic_empire_apply_faction_influence_modifier = { FACTION = rawatib }
				islamic_empire_apply_faction_influence_modifier = { FACTION = iqta }
				islamic_empire_apply_faction_influence_modifier = { FACTION = abid }
				islamic_empire_apply_faction_influence_modifier = { FACTION = ghulam }
				islamic_empire_apply_faction_influence_modifier = { FACTION = berber }

				
			}
			
		}

		## ISLAMIC EMPIRE - displaying the monthly change of influence
		every_in_global_list = {
			variable = islamic_empire_faction_influence_title

			## display
			set_variable = {
				name = islamic_empire_influence_internal_faction_monthly_display
				value = islamic_empire_influence_internal_faction_monthly
			}

			## Modifier appliance depending on the title - for generic extension, should be modified to not reference a specific title but a title with a flag/variable
			if = {
				limit = {
					this = title:d_fatimid_diwan_al_barid
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = barid }
			}
			if = {
				limit = {
					this = title:d_fatimid_diwan_al_insha
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = insha }
			}
			if = {
				limit = {
					this = title:d_fatimid_diwan_al_karaj
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = karaj }
			}
			if = {
				limit = {
					this = title:d_regiment_ghilman_turks
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = ghulam }
			}
			if = {
				limit = {
					this = title:d_regiment_abid
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = abid }
			}
			if = {
				limit = {
					this = title:d_kutama
				}
				islamic_empire_apply_faction_influence_modifier = { FACTION = berber }
			}
		}

		## ISLAMIC EMPIRE - displaying monthly effect to all rulers concercned with Ascendency mechanic
		every_in_global_list = {
			variable = islamic_empire_faction_ascendency_title
			limit = {
				holder = {
					is_alive = yes
				}
			}
			## display
			set_variable = {
				name = islamic_empire_ascendency_army_monthly_display
				value = islamic_empire_ascendency_army_monthly
			}
			set_variable = {
				name = islamic_empire_ascendency_diwan_monthly_display
				value = islamic_empire_ascendency_diwan_monthly
			}
		}

		## CHRISTIAN
		title:k_papal_state.holder = {
			change_government = theocracy_government
			add_trait = pope
		}
		every_ruler = {
			limit = {
				primary_title = { NOT = { this = title:k_papal_state } }
				has_government = theocracy_government
				religion = religion:christianity_religion
				highest_held_title_tier = tier_duchy
			}
			add_trait = bishop
		}

		## Give Christian Ruler some cleric/monks for court chaplain
		every_ruler = {
			limit = {
				faith = { religion_tag = christianity_religion }
			}
			trigger_event = ave_maria_christian_flavour.0001
		}
	}

	events = {
		game_rule.1000	#Autopopulate families.
		game_rule.1011	#Hungarian Migration management.
	}
}
